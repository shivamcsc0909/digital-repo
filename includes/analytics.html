<!-- ===== GOOGLE ANALYTICS 4 (GA4) ===== -->
<!-- Replace YOUR_GA4_MEASUREMENT_ID with your actual GA4 Measurement ID -->
<script async src="https://www.googletagmanager.com/gtag/js?id=YOUR_GA4_MEASUREMENT_ID"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  
  // Configure GA4
  gtag('config', 'YOUR_GA4_MEASUREMENT_ID', {
    // Enhanced measurement events
    enhanced_measurement: {
      scrolls: true,
      outbound_clicks: true,
      site_search: true,
      video_engagement: true,
      file_downloads: true
    },
    
    // Privacy settings
    anonymize_ip: true,
    allow_google_signals: true,
    allow_ad_personalization_signals: false,
    
    // Custom parameters
    custom_map: {
      'custom_parameter_1': 'client_type',
      'custom_parameter_2': 'service_interest'
    },
    
    // Page view settings
    send_page_view: true,
    page_title: document.title,
    page_location: window.location.href
  });
  
  // Set user properties
  gtag('config', 'YOUR_GA4_MEASUREMENT_ID', {
    'user_properties': {
      'device_type': /Mobi|Android/i.test(navigator.userAgent) ? 'mobile' : 'desktop',
      'visitor_type': localStorage.getItem('returning_visitor') ? 'returning' : 'new'
    }
  });
  
  // Mark as returning visitor
  localStorage.setItem('returning_visitor', 'true');
</script>

<!-- ===== GOOGLE TAG MANAGER (Alternative/Additional) ===== -->
<!-- Replace YOUR_GTM_ID with your actual GTM Container ID -->
<!--
<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','YOUR_GTM_ID');</script>

<!-- GTM noscript fallback (place after opening <body> tag) -->
<!--
<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=YOUR_GTM_ID"
height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
-->

<!-- ===== FACEBOOK PIXEL ===== -->
<!-- Replace YOUR_FACEBOOK_PIXEL_ID with your actual Pixel ID -->
<script>
  !function(f,b,e,v,n,t,s)
  {if(f.fbq)return;n=f.fbq=function(){n.callMethod?
  n.callMethod.apply(n,arguments):n.queue.push(arguments)};
  if(!f._fbq)f._fbq=n;n.push=n;n.loaded=!0;n.version='2.0';
  n.queue=[];t=b.createElement(e);t.async=!0;
  t.src=v;s=b.getElementsByTagName(e)[0];
  s.parentNode.insertBefore(t,s)}(window, document,'script',
  'https://connect.facebook.net/en_US/fbevents.js');
  
  fbq('init', 'YOUR_FACEBOOK_PIXEL_ID');
  fbq('track', 'PageView');
  
  // Custom events for digital marketing agency
  fbq('track', 'ViewContent', {
    content_type: 'website',
    content_category: 'digital_marketing'
  });
</script>

<!-- Facebook Pixel Noscript -->
<noscript>
  <img height="1" width="1" style="display:none"
    src="https://www.facebook.com/tr?id=YOUR_FACEBOOK_PIXEL_ID&ev=PageView&noscript=1"/>
</noscript>

<!-- ===== LINKEDIN INSIGHT TAG ===== -->
<!-- Replace YOUR_LINKEDIN_PARTNER_ID with your actual Partner ID -->
<script type="text/javascript">
_linkedin_partner_id = "YOUR_LINKEDIN_PARTNER_ID";
window._linkedin_data_partner_ids = window._linkedin_data_partner_ids || [];
window._linkedin_data_partner_ids.push(_linkedin_partner_id);
</script>

<script type="text/javascript">
(function(l) {
if (!l){window.lintrk = function(a,b){window.lintrk.q.push([a,b])};
window.lintrk.q=[]}
var s = document.getElementsByTagName("script")[0];
var b = document.createElement("script");
b.type = "text/javascript";b.async = true;
b.src = "https://snap.licdn.com/li.lms-analytics/insight.min.js";
s.parentNode.insertBefore(b, s);})(window.lintrk);
</script>

<noscript>
<img height="1" width="1" style="display:none;" alt="" src="https://px.ads.linkedin.com/collect/?pid=YOUR_LINKEDIN_PARTNER_ID&fmt=gif" />
</noscript>

<!-- ===== MICROSOFT CLARITY ===== -->
<!-- Replace YOUR_CLARITY_ID with your actual Clarity ID -->
<script type="text/javascript">
(function(c,l,a,r,i,t,y){
    c[a]=c[a]||function(){(c[a].q=c[a].q||[]).push(arguments)};
    t=l.createElement(r);t.async=1;t.src="https://www.clarity.ms/tag/"+i;
    y=l.getElementsByTagName(r)[0];y.parentNode.insertBefore(t,y);
})(window, document, "clarity", "script", "YOUR_CLARITY_ID");
</script>

<!-- ===== HOTJAR TRACKING ===== -->
<!-- Replace YOUR_HOTJAR_ID with your actual Hotjar Site ID -->
<script>
(function(h,o,t,j,a,r){
    h.hj=h.hj||function(){(h.hj.q=h.hj.q||[]).push(arguments)};
    h._hjSettings={hjid:YOUR_HOTJAR_ID,hjsv:6};
    a=o.getElementsByTagName('head')[0];
    r=o.createElement('script');r.async=1;
    r.src=t+h._hjSettings.hjid+j+h._hjSettings.hjsv;
    a.appendChild(r);
})(window,document,'https://static.hotjar.com/c/hotjar-','.js?sv=');
</script>

<!-- ===== CUSTOM ANALYTICS EVENTS ===== -->
<script>
// Digital Marketing Agency Specific Events
document.addEventListener('DOMContentLoaded', function() {
  
  // Track form interactions
  const forms = document.querySelectorAll('form');
  forms.forEach(form => {
    form.addEventListener('submit', function(e) {
      const formName = this.id || this.className || 'unknown_form';
      
      // GA4 Event
      gtag('event', 'form_submit', {
        form_name: formName,
        form_type: 'contact',
        page_location: window.location.href
      });
      
      // Facebook Pixel Event
      if (typeof fbq !== 'undefined') {
        fbq('track', 'Lead', {
          content_name: formName,
          content_category: 'form_submission'
        });
      }
      
      // LinkedIn Event
      if (typeof lintrk !== 'undefined') {
        lintrk('track', { conversion_id: 'form_submission' });
      }
    });
  });
  
  // Track button clicks
  const ctaButtons = document.querySelectorAll('.btn-primary, .nav-cta, .cta-button');
  ctaButtons.forEach(button => {
    button.addEventListener('click', function(e) {
      const buttonText = this.textContent.trim();
      const buttonType = this.classList.contains('nav-cta') ? 'navigation' : 'content';
      
      gtag('event', 'cta_click', {
        button_text: buttonText,
        button_type: buttonType,
        page_location: window.location.href
      });
    });
  });
  
  // Track service interest
  const serviceLinks = document.querySelectorAll('a[href*="services"], .service-card');
  serviceLinks.forEach(link => {
    link.addEventListener('click', function(e) {
      const serviceName = this.querySelector('.service-title')?.textContent || 
                         this.textContent.trim() || 'unknown_service';
      
      gtag('event', 'service_interest', {
        service_name: serviceName,
        engagement_type: 'click',
        page_location: window.location.href
      });
      
      if (typeof fbq !== 'undefined') {
        fbq('track', 'ViewContent', {
          content_name: serviceName,
          content_category: 'service'
        });
      }
    });
  });
  
  // Track phone number clicks
  const phoneLinks = document.querySelectorAll('a[href^="tel:"]');
  phoneLinks.forEach(link => {
    link.addEventListener('click', function(e) {
      gtag('event', 'phone_call', {
        phone_number: this.href.replace('tel:', ''),
        page_location: window.location.href
      });
      
      if (typeof fbq !== 'undefined') {
        fbq('track', 'Contact');
      }
    });
  });
  
  // Track email clicks
  const emailLinks = document.querySelectorAll('a[href^="mailto:"]');
  emailLinks.forEach(link => {
    link.addEventListener('click', function(e) {
      gtag('event', 'email_click', {
        email_address: this.href.replace('mailto:', ''),
        page_location: window.location.href
      });
    });
  });
  
  // Track external link clicks
  const externalLinks = document.querySelectorAll('a[href^="http"]:not([href*="' + window.location.hostname + '"])');
  externalLinks.forEach(link => {
    link.addEventListener('click', function(e) {
      gtag('event', 'click', {
        event_category: 'outbound',
        event_label: this.href,
        transport_type: 'beacon'
      });
    });
  });
  
  // Track scroll depth
  let scrollDepth = 0;
  const milestones = [25, 50, 75, 90, 100];
  
  window.addEventListener('scroll', function() {
    const scrollTop = window.pageYOffset;
    const docHeight = document.documentElement.scrollHeight - window.innerHeight;
    const scrollPercent = Math.round((scrollTop / docHeight) * 100);
    
    milestones.forEach(milestone => {
      if (scrollPercent >= milestone && scrollDepth < milestone) {
        scrollDepth = milestone;
        gtag('event', 'scroll', {
          event_category: 'engagement',
          event_label: milestone + '%',
          value: milestone
        });
      }
    });
  });
  
  // Track time on page
  let startTime = Date.now();
  let timeThresholds = [30, 60, 120, 300]; // 30s, 1m, 2m, 5m
  let trackedTimes = [];
  
  setInterval(function() {
    let timeOnPage = Math.round((Date.now() - startTime) / 1000);
    
    timeThresholds.forEach(threshold => {
      if (timeOnPage >= threshold && !trackedTimes.includes(threshold)) {
        trackedTimes.push(threshold);
        gtag('event', 'time_on_page', {
          event_category: 'engagement',
          event_label: threshold + 's',
          value: threshold
        });
      }
    });
  }, 10000); // Check every 10 seconds
  
  // Track video engagement (if videos are present)
  const videos = document.querySelectorAll('video');
  videos.forEach(video => {
    video.addEventListener('play', function() {
      gtag('event', 'video_start', {
        video_title: this.title || 'unknown_video',
        video_duration: this.duration
      });
    });
    
    video.addEventListener('ended', function() {
      gtag('event', 'video_complete', {
        video_title: this.title || 'unknown_video',
        video_duration: this.duration
      });
    });
  });
  
  // Track file downloads
  const downloadLinks = document.querySelectorAll('a[href$=".pdf"], a[href$=".doc"], a[href$=".docx"], a[href$=".zip"]');
  downloadLinks.forEach(link => {
    link.addEventListener('click', function(e) {
      const fileName = this.href.split('/').pop();
      gtag('event', 'file_download', {
        file_name: fileName,
        file_extension: fileName.split('.').pop(),
        link_url: this.href
      });
    });
  });
  
  // Track search usage (if search is present)
  const searchInputs = document.querySelectorAll('input[type="search"], #blogSearch');
  searchInputs.forEach(input => {
    input.addEventListener('keyup', function(e) {
      if (e.key === 'Enter' && this.value.trim() !== '') {
        gtag('event', 'search', {
          search_term: this.value.trim(),
          page_location: window.location.href
        });
      }
    });
  });
});

// Track page performance
window.addEventListener('load', function() {
  // Wait a bit for all resources to load
  setTimeout(function() {
    if (window.performance && window.performance.timing) {
      const timing = window.performance.timing;
      const loadTime = timing.loadEventEnd - timing.navigationStart;
      const domReadyTime = timing.domContentLoadedEventEnd - timing.navigationStart;
      
      gtag('event', 'page_performance', {
        event_category: 'performance',
        custom_parameter_1: 'load_time',
        value: Math.round(loadTime)
      });
      
      gtag('event', 'page_performance', {
        event_category: 'performance', 
        custom_parameter_1: 'dom_ready_time',
        value: Math.round(domReadyTime)
      });
    }
  }, 1000);
});

// Track errors
window.addEventListener('error', function(e) {
  gtag('event', 'exception', {
    description: e.message,
    fatal: false,
    page_location: window.location.href
  });
});

// Enhanced E-commerce tracking for service inquiries
function trackServiceInquiry(serviceName, inquiryType = 'form') {
  gtag('event', 'generate_lead', {
    currency: 'USD',
    value: 1000, // Estimated lead value
    items: [{
      item_id: serviceName.toLowerCase().replace(/\s+/g, '_'),
      item_name: serviceName,
      item_category: 'digital_marketing_service',
      item_category2: inquiryType,
      quantity: 1,
      price: 1000
    }]
  });
  
  // Facebook Pixel Lead Event
  if (typeof fbq !== 'undefined') {
    fbq('track', 'Lead', {
      content_name: serviceName,
      content_category: 'service_inquiry',
      value: 1000,
      currency: 'USD'
    });
  }
}

// Function to track conversions
function trackConversion(conversionType, value = 0) {
  gtag('event', 'conversion', {
    send_to: 'YOUR_GA4_MEASUREMENT_ID/CONVERSION_LABEL',
    value: value,
    currency: 'USD',
    conversion_type: conversionType
  });
}
</script>

<!-- ===== PRIVACY COMPLIANCE ===== -->
<script>
// Check for consent before loading tracking scripts
if (localStorage.getItem('analytics_consent') === 'true') {
  // Analytics consent given - scripts above will load normally
} else {
  // Show consent banner or disable analytics
  console.log('Analytics consent not given');
  
  // Disable GA4 if consent not given
  window['ga-disable-YOUR_GA4_MEASUREMENT_ID'] = true;
}

// Function to enable analytics after consent
function enableAnalytics() {
  localStorage.setItem('analytics_consent', 'true');
  window['ga-disable-YOUR_GA4_MEASUREMENT_ID'] = false;
  
  // Reload page to initialize analytics
  if (confirm('Analytics enabled. Reload page to activate tracking?')) {
    window.location.reload();
  }
}

// Function to disable analytics
function disableAnalytics() {
  localStorage.setItem('analytics_consent', 'false');
  window['ga-disable-YOUR_GA4_MEASUREMENT_ID'] = true;
  
  // Clear existing tracking data
  if (typeof gtag !== 'undefined') {
    gtag('consent', 'update', {
      'analytics_storage': 'denied',
      'ad_storage': 'denied'
    });
  }
}
</script>

<!-- ===== GDPR CONSENT CONFIGURATION ===== -->
<script>
// Configure consent mode (for EU visitors)
gtag('consent', 'default', {
  'analytics_storage': 'denied',
  'ad_storage': 'denied',
  'functionality_storage': 'granted',
  'security_storage': 'granted'
});

// Update consent when user accepts
function updateConsent() {
  gtag('consent', 'update', {
    'analytics_storage': 'granted',
    'ad_storage': 'granted'
  });
}
</script>

<!-- ===== CUSTOM DIMENSIONS & METRICS ===== -->
<script>
// Set custom dimensions
gtag('config', 'YOUR_GA4_MEASUREMENT_ID', {
  'custom_map': {
    'custom_parameter_1': 'user_type',
    'custom_parameter_2': 'lead_source',
    'custom_parameter_3': 'service_interest',
    'custom_parameter_4': 'company_size'
  }
});

// Function to set user properties
function setUserProperties(properties) {
  gtag('config', 'YOUR_GA4_MEASUREMENT_ID', {
    'user_properties': properties
  });
}

// Detect and set user type
function detectUserType() {
  const isReturningUser = localStorage.getItem('returning_visitor');
  const userType = isReturningUser ? 'returning' : 'new';
  
  setUserProperties({
    'user_type': userType,
    'device_type': /Mobi|Android/i.test(navigator.userAgent) ? 'mobile' : 'desktop',
    'traffic_source': document.referrer ? new URL(document.referrer).hostname : 'direct'
  });
}

// Call user type detection
detectUserType();
</script>

<!-- ===== USAGE INSTRUCTIONS ===== -->
<!--
SETUP INSTRUCTIONS:

1. Replace Placeholder IDs:
   - YOUR_GA4_MEASUREMENT_ID: Your Google Analytics 4 Measurement ID (G-XXXXXXXXXX)
   - YOUR_GTM_ID: Your Google Tag Manager Container ID (GTM-XXXXXXX)
   - YOUR_FACEBOOK_PIXEL_ID: Your Facebook Pixel ID
   - YOUR_LINKEDIN_PARTNER_ID: Your LinkedIn Partner ID
   - YOUR_CLARITY_ID: Your Microsoft Clarity Project ID
   - YOUR_HOTJAR_ID: Your Hotjar Site ID

2. Conversion Tracking:
   - Replace CONVERSION_LABEL with your actual conversion labels from Google Ads
   - Set up conversion goals in GA4 for form submissions, phone calls, etc.

3. Custom Events Being Tracked:
   - Form submissions (all forms)
   - CTA button clicks
   - Service page visits
   - Phone number clicks
   - Email clicks
   - External link clicks
   - Scroll depth (25%, 50%, 75%, 90%, 100%)
   - Time on page (30s, 1m, 2m, 5m)
   - Video engagement
   - File downloads
   - Search usage
   - Page performance metrics
   - JavaScript errors

4. E-commerce Events:
   - generate_lead: When someone submits a service inquiry
   - conversion: When someone completes a desired action

5. Privacy Compliance:
   - GDPR consent mode implemented
   - User can enable/disable analytics
   - Consent status stored in localStorage

6. Custom Dimensions:
   - user_type: new/returning
   - lead_source: traffic source
   - service_interest: which services viewed
   - company_size: from form data

7. Integration with Other Files:
   - Works with form-handler.js for form tracking
   - Integrates with blog.js for content engagement
   - Coordinates with main.js for user interactions

8. Testing:
   - Use Google Analytics DebugView to test events
   - Check Facebook Pixel Helper extension
   - Monitor LinkedIn Insight Tag in browser dev tools
   - Test Clarity and Hotjar recordings

9. Compliance:
   - Add privacy policy link
   - Include cookie notice
   - Implement consent management
   - Regular data retention cleanup

Example Usage in Other Files:

// Track custom conversion
trackConversion('quote_request', 500);

// Track service inquiry
trackServiceInquiry('SEO Services', 'contact_form');

// Set custom user properties
setUserProperties({
  'company_size': 'small_business',
  'service_interest': 'seo'
});

-->